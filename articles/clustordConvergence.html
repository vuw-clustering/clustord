<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>`clustord Convergence Tutorial • clustord</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="`clustord Convergence Tutorial">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-primary" data-bs-theme="dark" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">clustord</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/clustordConvergence.html">`clustord Convergence Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/clustordOrdinalModels.html">`clustord` Ordinal Models</a></li>
    <li><a class="dropdown-item" href="../articles/clustordStructureSummary.html">`clustord` Structure Summary</a></li>
    <li><a class="dropdown-item" href="../articles/clustordTutorial.html">`clustord` Tutorial</a></li>
    <li><a class="dropdown-item" href="../articles/RegressionwithOSM.html">Regression with the Ordered Stereotype Model (OSM)</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>`clustord Convergence Tutorial</h1>
                        <h4 data-toc-skip class="author">Louise
McMillan</h4>
            
      

      <div class="d-none name"><code>clustordConvergence.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The clustering algorithm in <code>clustord</code> is based on the EM
algorithm. This is an iterative algorithm for finding maximum likelihood
estimates. It is not possible to predict in advance how many iterations
the algorithm will require to converge on a solution for a given dataset
and clustering settings. But it will stop running after a specified
number of iterations. The user can change this value, but it defaults to
a middlingly low number (50) in order to prevent the algorithm from
running too long on a typical run.</p>
<p><strong>It is important to always check whether the algorithm has
converged at the end of a given run.</strong></p>
</div>
<div class="section level2">
<h2 id="how-to-check-convergence">How to check convergence<a class="anchor" aria-label="anchor" href="#how-to-check-convergence"></a>
</h2>
<p>Let’s use a simulated dataset to demonstrate how to check for
convergence using the simplest row clustering model.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://vuw-clustering.github.io/clustord/">clustord</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="va">long.df.sim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>Y<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sample.html" class="external-link">sample</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">3</span>,<span class="fl">5</span><span class="op">*</span><span class="fl">30</span>,replace<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span>,</span>
<span>                          ROW<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">30</span>,times<span class="op">=</span><span class="fl">5</span><span class="op">)</span><span class="op">)</span>,COL<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>,each<span class="op">=</span><span class="fl">30</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">fit</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clustord.html">clustord</a></span><span class="op">(</span><span class="va">Y</span> <span class="op">~</span> <span class="va">ROWCLUST</span>, model<span class="op">=</span><span class="st">"POM"</span>, nclus.row<span class="op">=</span><span class="fl">2</span>, long.df<span class="op">=</span><span class="va">long.df.sim</span>, </span>
<span>                nstarts<span class="op">=</span><span class="fl">2</span>, EM.control <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>EMcycles<span class="op">=</span><span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Converting factor ROW to numeric.</span></span>
<span><span class="co">#&gt; Randomly generated start #1</span></span>
<span><span class="co">#&gt; Found better incomplete log-like: -164.97238416875 </span></span>
<span><span class="co">#&gt; Randomly generated start #2</span></span>
<span><span class="co">#&gt; Found better incomplete log-like: -164.81282792906</span></span>
<span><span class="co">#&gt; EM algorithm has not converged. Please try again, or with a different random seed, or with more starting points.</span></span></code></pre></div>
<p>You can check the convergence in three ways.</p>
<ol style="list-style-type: decimal">
<li>Display the results object:</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; clustord(formula = Y ~ ROWCLUST, model = "POM", nclus.row = 2, </span></span>
<span><span class="co">#&gt;     long.df = long.df.sim, EM.control = list(EMcycles = 2), nstarts = 2)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Clustering mode:</span></span>
<span><span class="co">#&gt;  row clustering</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Converged:</span></span>
<span><span class="co">#&gt;  FALSE</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cluster sizes:</span></span>
<span><span class="co">#&gt; Row clusters:  30 0</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Display the summary of the results:</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; clustord(formula = Y ~ ROWCLUST, model = "POM", nclus.row = 2, </span></span>
<span><span class="co">#&gt;     long.df = long.df.sim, EM.control = list(EMcycles = 2), nstarts = 2)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Clustering mode:</span></span>
<span><span class="co">#&gt;  row clustering</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Converged:</span></span>
<span><span class="co">#&gt;  FALSE</span></span>
<span><span class="co">#&gt; AIC: 337.5446 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; BIC: 349.5871 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cluster sizes:</span></span>
<span><span class="co">#&gt; Row clusters:  30 0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter estimates:</span></span>
<span><span class="co">#&gt; $mu</span></span>
<span><span class="co">#&gt;    mu_1    mu_2 </span></span>
<span><span class="co">#&gt; -0.5103  0.9408 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $rowc</span></span>
<span><span class="co">#&gt;  rowc_1  rowc_2 </span></span>
<span><span class="co">#&gt;  0.2454 -0.2454</span></span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Fetch the convergence check from the results object:</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit</span><span class="op">$</span><span class="va">EM.status</span><span class="op">$</span><span class="va">converged</span></span>
<span><span class="co">#&gt; [1] FALSE</span></span></code></pre></div>
<p>The convergence will be shown as <code>TRUE</code> if the algorithm
has converged, and <code>FALSE</code> if it has not. The output during
the completion of the algorithm run will also display a message
indicating whether or not it has converged.</p>
</div>
<div class="section level2">
<h2 id="why-is-convergence-important">Why is convergence important?<a class="anchor" aria-label="anchor" href="#why-is-convergence-important"></a>
</h2>
<p>If the algorithm has not converged, that means that it has not found
the optimum solution. Therefore, the parameter estimates will not be
accurate and the cluster memberships may not be accurate either.</p>
</div>
<div class="section level2">
<h2 id="what-to-do-if-the-algorithm-has-not-converged">What to do if the algorithm has not converged<a class="anchor" aria-label="anchor" href="#what-to-do-if-the-algorithm-has-not-converged"></a>
</h2>
<p>If the algorithm has not converged, then the best solution is to keep
running it from where it stopped, until it does converge. That is, do
not start the algorithm again from scratch, but use the output from the
run that stopped without converging as the input for a new run.</p>
<p>In order to do this, use the <code><a href="../reference/rerun.html">rerun()</a></code> function. This
allows you to pass in a previous run and use it as the starting point of
a new run. You supply the output of the previous run, and the dataset,
and any options you want in <code>EM.control</code>, which may include
changing the number of iterations.</p>
<p>For diagnostic purposes, you also have the option of changing the
<code>verbose</code> setting for the new run or supplying a different
<code>optim.control</code> list. <code>optim.control</code> has an entry
called <code>trace</code> which can make <code><a href="https://rdrr.io/r/stats/optim.html" class="external-link">optim()</a></code> produce
much more verbose output during the M-step, but most users will not need
this functionality.</p>
<p>For now, we will just ask for more iterations for the next run using
<code>EM.control</code> since the previous run only used 5.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">fit_continued</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rerun.html">rerun</a></span><span class="op">(</span><span class="va">fit</span>, long.df<span class="op">=</span><span class="va">long.df.sim</span>, EM.control<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>EMcycles<span class="op">=</span><span class="fl">20</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; Converting factor ROW to numeric.</span></span>
<span><span class="co">#&gt; EM algorithm has successfully converged.</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/summary.html" class="external-link">summary</a></span><span class="op">(</span><span class="va">fit_continued</span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Call:</span></span>
<span><span class="co">#&gt; clustord(formula = formula, model = model, nclus.row = nclus.row, </span></span>
<span><span class="co">#&gt;     nclus.column = nclus.column, long.df = long.df, initvect = initvect, </span></span>
<span><span class="co">#&gt;     pi.init = pi.init, kappa.init = kappa.init, EM.control = EM.control, </span></span>
<span><span class="co">#&gt;     optim.control = optim.control, verbose = verbose)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Clustering mode:</span></span>
<span><span class="co">#&gt;  row clustering</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Converged:</span></span>
<span><span class="co">#&gt;  TRUE</span></span>
<span><span class="co">#&gt; AIC: 337.4933 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; BIC: 349.5358 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Cluster sizes:</span></span>
<span><span class="co">#&gt; Row clusters:  30 0 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Parameter estimates:</span></span>
<span><span class="co">#&gt; $mu</span></span>
<span><span class="co">#&gt;    mu_1    mu_2 </span></span>
<span><span class="co">#&gt; -0.5740  0.8747 </span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $rowc</span></span>
<span><span class="co">#&gt;  rowc_1  rowc_2 </span></span>
<span><span class="co">#&gt;  0.1696 -0.1696</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="what-if-it-still-doesnt-converge">What if it still doesn’t converge?<a class="anchor" aria-label="anchor" href="#what-if-it-still-doesnt-converge"></a>
</h2>
<p>If you still find that the algorithm does not converge within
e.g. 200 iterations, then it would be worth running the algorithm from
scratch (i.e. without supplying <code>initvect</code>) and increasing
the number of starts in order to improve the chances of finding a better
starting point that might allow the algorithm to converge faster. You
should use at least 20 starting points for any clsutering structure more
complex than <code>Y ~ ROWCLUST</code> (the simplest model).</p>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Louise McMillan, Daniel Fernández Martínez, Ying Cui, Eleni Matechou.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
